---
// src/components/CodeInterpreter.astro
---

<div class="hs-accordion-group">
  <div class="hs-accordion active" id="hs-basic-heading-one">
    <button class="hs-accordion-toggle hs-accordion-active:text-blue-600 group py-3 inline-flex items-center gap-x-3 w-full font-semibold text-left text-gray-800 transition hover:text-gray-500 dark:hs-accordion-active:text-blue-500 dark:text-gray-200 dark:hover:text-gray-400" aria-controls="hs-basic-collapse-one">
      <svg class="hs-accordion-active:hidden hs-accordion-active:text-blue-600 hs-accordion-active:group-hover:text-blue-600 block w-3 h-3 text-gray-600 group-hover:text-gray-500 dark:text-gray-400" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M2 5L8.16086 10.6869C8.35239 10.8637 8.64761 10.8637 8.83914 10.6869L15 5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <svg class="hs-accordion-active:block hs-accordion-active:text-blue-600 hs-accordion-active:group-hover:text-blue-600 hidden w-3 h-3 text-gray-600 group-hover:text-gray-500 dark:text-gray-400" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M2 11L8.16086 5.31305C8.35239 5.13625 8.64761 5.13625 8.83914 5.31305L15 11" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      Code Interpreter
    </button>
    <div id="hs-basic-collapse-one" class="hs-accordion-content w-full overflow-hidden transition-[height] duration-300" aria-labelledby="hs-basic-heading-one">
      <div class="pb-4 dark:text-gray-200">
        <div class="mb-4">
          <input
            type="text"
            id="storeId"
            placeholder="Store ID"
            class="py-3 px-4 block w-full border-gray-200 rounded-md text-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400"
          />
          <input
            type="text"
            id="publicKey"
            placeholder="Public Key"
            class="mt-2 py-3 px-4 block w-full border-gray-200 rounded-md text-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400"
          />
          <button
            id="initializeSwellBtn"
            class="mt-2 py-3 px-4 inline-flex justify-center items-center gap-2 rounded-md border border-transparent font-semibold bg-blue-500 text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all text-sm dark:focus:ring-offset-gray-800"
          >
            Initialize Swell
          </button>
        </div>
        <div class="mb-4">
          <textarea
            id="queryInput"
            rows="4"
            placeholder="Enter your Swell.js query here (e.g., swell.products.list({limit: 25, page: 1}))"
            class="py-3 px-4 block w-full border-gray-200 rounded-md text-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400"
          ></textarea>
          <button
            id="runQueryBtn"
            class="mt-2 py-3 px-4 inline-flex justify-center items-center gap-2 rounded-md border border-transparent font-semibold bg-green-500 text-white hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-all text-sm dark:focus:ring-offset-gray-800"
          >
            Run Query
          </button>
        </div>
        <div class="bg-gray-100 dark:bg-gray-800 p-4 rounded-md">
          <pre><code id="result" class="language-json block whitespace-pre-wrap"></code></pre>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  import swell from 'swell-js';
  import 'preline';

  // Initialize swell with placeholder values
  swell.init('placeholder-store-id', 'placeholder-public-key');

  const storeIdInput = document.getElementById('storeId');
  const publicKeyInput = document.getElementById('publicKey');
  const initializeSwellBtn = document.getElementById('initializeSwellBtn');
  const queryInput = document.getElementById('queryInput');
  const runQueryBtn = document.getElementById('runQueryBtn');
  const resultElement = document.getElementById('result');

  initializeSwellBtn.addEventListener('click', () => {
    const storeId = storeIdInput.value;
    const publicKey = publicKeyInput.value;
    swell.init(storeId, publicKey);
    resultElement.textContent = 'Swell initialized successfully';
  });

  runQueryBtn.addEventListener('click', async () => {
    try {
      const query = queryInput.value;
      // Use Function constructor to create a function from the input string
      const queryFunction = new Function('swell', `return ${query}`);
      const result = await queryFunction(swell);
      resultElement.textContent = JSON.stringify(result, null, 2);
    } catch (error) {
      resultElement.textContent = `Error: ${error.message}`;
    }
  });
</script>
