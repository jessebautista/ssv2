---
// src/components/CodeInterpreter.astro
---

<div class="code-interpreter-section">
  <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200">Code Interpreter</h2>
  <div class="pb-4 dark:text-gray-200">
    <div class="mb-4">
      <input
        type="text"
        id="storeId"
        placeholder="Store ID"
        class="py-3 px-4 block w-full border-gray-200 rounded-md text-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400"
      />
      <input
        type="text"
        id="publicKey"
        placeholder="Public Key"
        class="mt-2 py-3 px-4 block w-full border-gray-200 rounded-md text-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400"
      />
      <button
        id="initializeSwellBtn"
        class="mt-2 py-3 px-4 inline-flex justify-center items-center gap-2 rounded-md border border-transparent font-semibold bg-blue-500 text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all text-sm dark:focus:ring-offset-gray-800"
      >
        Initialize Swell
      </button>
    </div>
    <div class="mb-4">
      <textarea
        id="queryInput"
        rows="4"
        placeholder="Enter your Swell.js query here (e.g., swell.products.list({limit: 25, page: 1}))"
        class="py-3 px-4 block w-full border-gray-200 rounded-md text-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400"
      ></textarea>
      <button
        id="runQueryBtn"
        class="mt-2 py-3 px-4 inline-flex justify-center items-center gap-2 rounded-md border border-transparent font-semibold bg-green-500 text-white hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-all text-sm dark:focus:ring-offset-gray-800"
      >
        Run Query
      </button>
    </div>
    <div class="bg-gray-100 dark:bg-gray-800 p-4 rounded-md">
      <pre><code id="result" class="language-json block whitespace-pre-wrap"></code></pre>
    </div>
  </div>
</div>

<script>
  import swell from 'swell-js';

  // Initialize swell with placeholder values
  swell.init('placeholder-store-id', 'placeholder-public-key');

  const storeIdInput = document.getElementById('storeId');
  const publicKeyInput = document.getElementById('publicKey');
  const initializeSwellBtn = document.getElementById('initializeSwellBtn');
  const queryInput = document.getElementById('queryInput');
  const runQueryBtn = document.getElementById('runQueryBtn');
  const resultElement = document.getElementById('result');

  initializeSwellBtn.addEventListener('click', () => {
    const storeId = storeIdInput.value;
    const publicKey = publicKeyInput.value;
    swell.init(storeId, publicKey);
    resultElement.textContent = 'Swell initialized successfully';
  });

  runQueryBtn.addEventListener('click', async () => {
    try {
      const query = queryInput.value;
      // Use Function constructor to create a function from the input string
      const queryFunction = new Function('swell', `return ${query}`);
      const result = await queryFunction(swell);
      resultElement.textContent = JSON.stringify(result, null, 2);
    } catch (error) {
      resultElement.textContent = `Error: ${error.message}`;
    }
  });
</script>
